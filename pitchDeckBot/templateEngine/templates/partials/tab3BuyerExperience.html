    <!-- ================================================================ -->
    <!-- TAB 4: BUY-SIDE WORKFLOW (HORIZONTAL FLOW) -->
    <!-- ================================================================ -->
    <section id="buy-flow" class="tab-section">
      <div class="mb-5">
        <h1 class="font-heading text-3xl sm:text-4xl font-bold text-gray-900 mb-3">Buyer Experience -- From Invoice Receipt to {{ navPartner1Name }} Payment</h1>
        <p class="text-gray-600 max-w-2xl text-base leading-relaxed">The buyer receives an invoice with embedded {{ navPartner1Name }} payment options. Every payment routes through {{ navPartner1Name }} rails. Click any node for details.</p>
      </div>
      <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
        <div class="flex flex-wrap gap-1.5">
          {% for party in parties %}
          <span class="party-badge {{ party.bgClass }} {{ party.textClass }}">{{ party.label }}</span>
          {% endfor %}
        </div>
        <div class="flex items-center gap-1 bg-white rounded-lg p-1 shadow-sm border border-gray-100">
          <button class="layer-toggle active-toggle" data-flow="buy" data-layer="all">Full Flow</button>
          <button class="layer-toggle" data-flow="buy" data-layer="compliance"><span class="inline-block w-2 h-2 rounded-full bg-primary mr-1"></span>Compliance</button>
          <button class="layer-toggle" data-flow="buy" data-layer="payment"><span class="inline-block w-2 h-2 rounded-full bg-payfac mr-1"></span>Payment</button>
        </div>
      </div>

      <div class="scroll-hint items-center gap-2 text-xs text-gray-400 mb-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
        <span>Scroll to see full flow</span>
      </div>

      <div class="flow-diagram bg-white rounded-xl shadow-sm" id="buyFlowDiagram">
        <div class="flow-scroll p-4 sm:p-6">
          <div class="flow-h">

            <!-- ===== INBOUND ZONE ===== -->
            <div class="env-zone env-zone-seller">
              <span class="env-zone-label">Inbound</span>
              <div class="flow-node node-w" data-layer="{{ buyerFlowNodes['buy-receive'].layer }}" data-node-id="buy-receive" onclick="showDetail('buy','buy-receive')">
                <div class="flex gap-1 mb-1.5">
                  {% for party in buyerFlowNodes['buy-receive'].parties %}
                  <span class="party-badge {{ partyStyleMap[party].bg }} {{ partyStyleMap[party].text }}">{{ party }}</span>
                  {% endfor %}
                </div>
                <h4 class="font-heading font-semibold text-xs text-gray-900 leading-tight">{{ buyerFlowNodes['buy-receive'].title }}</h4>
                <p class="text-[10px] text-gray-500 mt-0.5">{{ buyerFlowNodes['buy-receive'].subtitle }}</p>
              </div>
            </div>

            <svg width="36" height="20" viewBox="0 0 36 20" class="shrink-0 mx-1.5 compliance-connector"><line x1="0" y1="10" x2="28" y2="10" stroke="#CBD5E1" stroke-width="2"/><polygon points="28,5 36,10 28,15" fill="#CBD5E1"/></svg>

            <!-- ===== CLEAR PLATFORM ZONE ===== -->
            <div class="env-zone env-zone-clear">
              <span class="env-zone-label">Clear Platform</span>

              <!-- 2. Validate -->
              <div class="flow-node node-w-lg" data-layer="{{ buyerFlowNodes['buy-validate'].layer }}" data-node-id="buy-validate" onclick="showDetail('buy','buy-validate')">
                <div class="flex gap-1 mb-1.5">
                  {% for party in buyerFlowNodes['buy-validate'].parties %}
                  <span class="party-badge {{ partyStyleMap[party].bg }} {{ partyStyleMap[party].text }}">{{ party }}</span>
                  {% endfor %}
                </div>
                <h4 class="font-heading font-semibold text-xs text-gray-900 leading-tight">{{ buyerFlowNodes['buy-validate'].title }}</h4>
                <div class="flex flex-wrap items-center gap-1 mt-1.5">
                  {% for step in buyerValidationSteps %}
                  <span class="validation-step">{{ step.label }}</span>{% if not loop.last %}<span class="validation-arrow">&rarr;</span>{% endif %}
                  {% endfor %}
                </div>
              </div>

              <svg width="36" height="20" viewBox="0 0 36 20" class="shrink-0 mx-1.5 compliance-connector"><line x1="0" y1="10" x2="28" y2="10" stroke="#CBD5E1" stroke-width="2"/><polygon points="28,5 36,10 28,15" fill="#CBD5E1"/></svg>

              <!-- 3. Present to Buyer -->
              <div class="flow-node node-w" data-layer="{{ buyerFlowNodes['buy-present'].layer }}" data-node-id="buy-present" onclick="showDetail('buy','buy-present')">
                <div class="flex gap-1 mb-1.5">
                  {% for party in buyerFlowNodes['buy-present'].parties %}
                  <span class="party-badge {{ partyStyleMap[party].bg }} {{ partyStyleMap[party].text }}">{{ party }}</span>
                  {% endfor %}
                </div>
                <h4 class="font-heading font-semibold text-xs text-gray-900 leading-tight">{{ buyerFlowNodes['buy-present'].title }}</h4>
                <p class="text-[10px] text-gray-500 mt-0.5">{{ buyerFlowNodes['buy-present'].subtitle }}</p>
              </div>

              <!-- Fan-out SVG -->
              <svg viewBox="0 0 56 280" class="shrink-0 mx-1 payment-connector" style="width:44px; height:280px;">
                <text x="0" y="14" fill="#B45309" font-size="10" font-weight="700" font-family="Syne, sans-serif">PAY OPTIONS</text>
                <path d="M 0 140 C 28 140, 28 32, 52 32" stroke="#F7B600" stroke-width="2" fill="none" class="gold-dash"/>
                <polygon points="49,28 56,32 49,36" fill="#F7B600"/>
                <line x1="0" y1="140" x2="52" y2="140" stroke="#F7B600" stroke-width="2" class="gold-dash"/>
                <polygon points="49,136 56,140 49,144" fill="#F7B600"/>
                <path d="M 0 140 C 28 140, 28 248, 52 248" stroke="#F7B600" stroke-width="2" fill="none" class="gold-dash"/>
                <polygon points="49,244 56,248 49,252" fill="#F7B600"/>
              </svg>

              <!-- PAYMENT ZONE: 3 options + merge + execute -->
              <div class="payment-zone flex items-center gap-0 px-3 py-7 pt-9">
                <span class="payment-zone-label">Payment Layer -- {{ navPartner1Name }} + Clear</span>

                <!-- 3 payment options -->
                <div class="flex flex-col justify-between shrink-0" style="height:280px;">
                  <div class="flow-node node-w-sm" data-layer="{{ buyerFlowNodes['buy-qr'].layer }}" data-node-id="buy-qr" onclick="showDetail('buy','buy-qr')">
                    <div class="flex gap-1 mb-1">
                      {% for party in buyerFlowNodes['buy-qr'].parties %}
                      <span class="party-badge {{ partyStyleMap[party].bg }} {{ partyStyleMap[party].text }}">{{ party }}</span>
                      {% endfor %}
                    </div>
                    <h4 class="font-heading font-semibold text-xs text-gray-900 leading-tight">{{ buyerFlowNodes['buy-qr'].title }}</h4>
                    <p class="text-[10px] text-gray-500 mt-0.5">{{ buyerFlowNodes['buy-qr'].subtitle }}</p>
                  </div>
                  <div class="flow-node node-w-sm" data-layer="{{ buyerFlowNodes['buy-link'].layer }}" data-node-id="buy-link" onclick="showDetail('buy','buy-link')">
                    <div class="flex gap-1 mb-1">
                      {% for party in buyerFlowNodes['buy-link'].parties %}
                      <span class="party-badge {{ partyStyleMap[party].bg }} {{ partyStyleMap[party].text }}">{{ party }}</span>
                      {% endfor %}
                    </div>
                    <h4 class="font-heading font-semibold text-xs text-gray-900 leading-tight">{{ buyerFlowNodes['buy-link'].title }}</h4>
                    <p class="text-[10px] text-gray-500 mt-0.5">{{ buyerFlowNodes['buy-link'].subtitle }}</p>
                  </div>
                  <div class="flow-node node-w-sm" data-layer="{{ buyerFlowNodes['buy-incentives'].layer }}" data-node-id="buy-incentives" onclick="showDetail('buy','buy-incentives')">
                    <div class="flex gap-1 mb-1">
                      {% for party in buyerFlowNodes['buy-incentives'].parties %}
                      <span class="party-badge {{ partyStyleMap[party].bg }} {{ partyStyleMap[party].text }}">{{ party }}</span>
                      {% endfor %}
                    </div>
                    <h4 class="font-heading font-semibold text-xs text-gray-900 leading-tight">{{ buyerFlowNodes['buy-incentives'].title }}</h4>
                    <p class="text-[10px] text-gray-500 mt-0.5">{{ buyerFlowNodes['buy-incentives'].subtitle }}</p>
                  </div>
                </div>

                <!-- Merge SVG -->
                <svg viewBox="0 0 56 280" class="shrink-0" style="width:44px; height:280px;">
                  <path d="M 0 32 C 28 32, 28 140, 52 140" stroke="#F7B600" stroke-width="2" fill="none" class="gold-dash"/>
                  <path d="M 0 140 L 52 140" stroke="#F7B600" stroke-width="2" class="gold-dash"/>
                  <path d="M 0 248 C 28 248, 28 140, 52 140" stroke="#F7B600" stroke-width="2" fill="none" class="gold-dash"/>
                  <polygon points="49,136 56,140 49,144" fill="#F7B600"/>
                </svg>

                <!-- Payment Execution -->
                <div class="flow-node node-w shrink-0" data-layer="{{ buyerFlowNodes['buy-execute'].layer }}" data-node-id="buy-execute" onclick="showDetail('buy','buy-execute')">
                  <div class="flex gap-1 mb-1.5">
                    {% for party in buyerFlowNodes['buy-execute'].parties %}
                    <span class="party-badge {{ partyStyleMap[party].bg }} {{ partyStyleMap[party].text }}">{{ party }}</span>
                    {% endfor %}
                  </div>
                  <h4 class="font-heading font-semibold text-xs text-gray-900 leading-tight">{{ buyerFlowNodes['buy-execute'].title }}</h4>
                  <p class="text-[10px] text-gray-500 mt-0.5">{{ buyerFlowNodes['buy-execute'].subtitle }}</p>
                </div>
              </div>
              <!-- END PAYMENT ZONE -->
            </div>

            <svg width="36" height="20" viewBox="0 0 36 20" class="shrink-0 mx-1.5 compliance-connector"><line x1="0" y1="10" x2="28" y2="10" stroke="#CBD5E1" stroke-width="2"/><polygon points="28,5 36,10 28,15" fill="#CBD5E1"/></svg>

            <!-- ===== SETTLEMENT ZONE ===== -->
            <div class="env-zone env-zone-delivery">
              <span class="env-zone-label">Settlement</span>
              <div class="flow-node node-w" data-layer="{{ buyerFlowNodes['buy-notify'].layer }}" data-node-id="buy-notify" onclick="showDetail('buy','buy-notify')">
                <div class="flex gap-1 mb-1.5">
                  {% for party in buyerFlowNodes['buy-notify'].parties %}
                  <span class="party-badge {{ partyStyleMap[party].bg }} {{ partyStyleMap[party].text }}">{{ party }}</span>
                  {% endfor %}
                </div>
                <h4 class="font-heading font-semibold text-xs text-gray-900 leading-tight">{{ buyerFlowNodes['buy-notify'].title }}</h4>
                <p class="text-[10px] text-gray-500 mt-0.5">{{ buyerFlowNodes['buy-notify'].subtitle }}</p>
              </div>
            </div>

          </div>
        </div>
        <!-- Security & Infrastructure -->
        <div class="security-strip">
          <span class="strip-label mr-1">Security</span>
          <span class="security-badge badge-green"><svg fill="none" stroke="#16A34A" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>OpenPeppol Certified</span>
          <span class="security-badge badge-blue"><svg fill="none" stroke="#2563EB" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>Encrypted API</span>
          <span class="security-badge badge-purple"><svg fill="none" stroke="#7C3AED" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>Peppol PKI</span>
          <span class="security-badge badge-green"><svg fill="none" stroke="#16A34A" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>AES-256</span>
          <span class="security-badge badge-gray"><svg fill="none" stroke="#6B7280" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>FTA Signing</span>
          <span class="security-badge badge-visa"><svg fill="none" stroke="#B45309" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>3DS Auth</span>
          <span class="security-divider"></span>
          <span class="strip-label mr-1">Infrastructure</span>
          <span class="security-badge badge-teal"><svg fill="none" stroke="#0D9488" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>UAE-Hosted</span>
          <span class="security-badge badge-teal"><svg fill="none" stroke="#0D9488" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>Data Residency</span>
          <span class="security-badge badge-teal"><svg fill="none" stroke="#0D9488" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>ISO 27001</span>
        </div>
      </div>

      <!-- Detail Panel -->
      <div id="buyDetailPanel" class="detail-panel bg-white rounded-xl shadow-lg border-2 border-primary overflow-hidden">
        <div class="p-6">
          <div class="flex items-start justify-between mb-3">
            <div><div id="buyDetailParties" class="flex flex-wrap gap-1.5 mb-2"></div><h3 id="buyDetailTitle" class="font-heading font-bold text-lg text-gray-900"></h3><p id="buyDetailSubtitle" class="text-sm text-gray-500 mt-0.5"></p></div>
            <button onclick="closeDetail('buy')" class="text-gray-400 hover:text-gray-600 p-1 shrink-0"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
          </div>
          <p id="buyDetailBody" class="text-sm text-gray-700 leading-relaxed mb-4"></p>
          <div class="bg-gray-50 rounded-lg p-3"><p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Data Flow</p><p id="buyDetailDataFlow" class="text-xs text-gray-600"></p></div>
        </div>
      </div>

      <!-- ===== BUYER DASHBOARD MOCKUP ===== -->
      <h3 class="font-heading font-bold text-lg text-gray-900 mt-10 mb-4">What the Buyer Sees</h3>
      <div class="dashboard-mockup mb-6">
        <div class="bg-gray-50 px-5 py-3 border-b border-gray-200 flex items-center gap-2">
          <div class="w-6 h-6 {{ buyerDashboard.iconBgClass }} rounded flex items-center justify-center"><span class="text-white" style="font-size:7px; font-weight:800;">{{ buyerDashboard.iconInitial }}</span></div>
          <span class="text-sm font-bold text-gray-800">{{ buyerDashboard.title }}</span>
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 p-4 border-b border-gray-100">
          {% for stat in buyerDashboard.stats %}
          <div class="bg-gray-50 rounded-lg p-3 text-center"><p class="font-heading font-bold text-xl text-{{ stat.colorClass }}">{{ stat.value }}</p><p class="text-[10px] text-gray-500 uppercase font-semibold">{{ stat.label }}</p></div>
          {% endfor %}
        </div>
        <div class="overflow-x-auto">
          <table class="dashboard-table">
            <thead><tr>{% for h in buyerDashboard.tableHeaders %}<th>{{ h }}</th>{% endfor %}</tr></thead>
            <tbody>
              {% for row in buyerDashboard.rows %}
              <tr>{% for cell in row.cells %}<td>{{ cell | safe }}</td>{% endfor %}</tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </section>